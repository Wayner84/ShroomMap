var W=Object.defineProperty;var j=(u,h,g)=>h in u?W(u,h,{enumerable:!0,configurable:!0,writable:!0,value:g}):u[h]=g;var D=(u,h,g)=>j(u,typeof h!="symbol"?h+"":h,g);(function(){"use strict";var u=(e=>(e[e.Poor=0]="Poor",e[e.Caution=1]="Caution",e[e.Ideal=2]="Ideal",e))(u||{});const h=new Set([20,30,100]),g=new Set([90,95]),O=new Set([40,50,60,70,80]),v=10;function S(e,t,s){const o=new Uint8Array(t*s);for(let n=0;n<e.length;n+=1){const r=e[n];h.has(r)?o[n]=2:O.has(r)?o[n]=0:(r===v||g.has(r),o[n]=1)}for(let n=0;n<s;n+=1)for(let r=0;r<t;r+=1){const a=n*t+r;if(e[a]!==v)continue;let l=!1;for(let f=Math.max(0,n-1);f<=Math.min(s-1,n+1)&&!l;f+=1)for(let d=Math.max(0,r-1);d<=Math.min(t-1,r+1);d+=1){if(d===r&&f===n)continue;const c=f*t+d;if(o[c]===2){l=!0;break}}l&&(o[a]=2)}return o}function y(e){if(!Number.isFinite(e))return 0;const t=e/1e3;return t<=.8?60:t<1.05?80+(t-.8)/.25*20:t<=1.35?100:t<=1.6?100-(t-1.35)/.25*30:t<=1.8?70-(t-1.6)/.2*40:20}function A(e){if(!Number.isFinite(e))return 0;const t=e/10;return t<=.5?5:t<3?Math.min(100,(t-.5)/2.5*80+20):t<=6?100:t<=10?100-(t-6)/4*50:t<=15?Math.max(20,50-(t-10)/5*50):10}function C(e){if(!Number.isFinite(e))return 0;const o=-.5*((e-6)/.6)**2,n=Math.exp(o)*100;return Math.max(0,Math.min(100,n))}function F(e,t,s){if(![e,t,s].every(m=>Number.isFinite(m)&&m>=0))return 0;const o=e/10,n=t/10,r=s/10,a=o+n+r;if(a<=0)return 0;const l=o/a*100,f=n/a*100,d=r/a*100;let c=100;const x=Math.max(0,Math.abs(l-45)-10),M=Math.max(0,Math.abs(f-25)-6),w=Math.max(0,Math.abs(d-30)-10);return c-=x*2.2,c-=M*2.8,c-=w*1.5,l>70&&(c-=(l-70)*2.8),f>45&&(c-=(f-45)*3),Math.max(0,Math.min(100,c))}var I=(e=>(e[e.Poor=0]="Poor",e[e.Caution=1]="Caution",e[e.Ideal=2]="Ideal",e))(I||{});const b={ph:.32,organic:.22,texture:.28,moisture:.18};function E(e){let t=0,s=0;for(const o of e)Number.isFinite(o.score)&&(s+=o.score*o.weight,t+=o.weight);return t===0?0:s/t}function T(e){const t=C(e.ph),s=A(e.orcdrc),o=F(e.sand,e.clay,e.silt),n=y(e.bdod),r=E([{score:t,weight:b.ph},{score:s,weight:b.organic},{score:o,weight:b.texture},{score:n,weight:b.moisture}]);return{ph:t,organic:s,texture:o,moisture:n,overall:Math.max(0,Math.min(100,r))}}function _(e,t){if(!Number.isFinite(e)||t===u.Poor)return 0;const s=t===u.Caution?e-10:e;return s>=70?t===u.Caution?1:2:s>=45?1:0}class R{constructor(){D(this,"total",0);D(this,"n",0)}add(t){Number.isFinite(t)&&(this.total+=t,this.n+=1)}get count(){return this.n}get average(){return this.n===0?0:this.total/this.n}}const N=self;N.onmessage=e=>{const{soil:t,landCover:s,bbox:o,requestId:n}=e.data,r=Math.min(t.width,s.width),a=Math.min(t.height,s.height),l=r*a,f=s.codes.length===l?s.codes:s.codes.slice(0,l),d=S(f,r,a),c=new Uint8Array(r*a),x=new Float32Array(r*a),M=new Uint8Array(r*a),w=new R,m={ideal:0,caution:0,poor:0};for(let i=0;i<r*a;i+=1){const P=T({ph:t.data.phh2o[i],orcdrc:t.data.orcdrc[i],bdod:t.data.bdod[i],sand:t.data.sand[i],clay:t.data.clay[i],silt:t.data.silt[i]}),k=d[i]??u.Poor,p=_(P.overall,k);x[i]=P.overall,M[i]=p,c[i]=f[i]===v?1:0,w.add(P.overall),p===I.Ideal?m.ideal+=1:p===I.Caution?m.caution+=1:m.poor+=1}const U={width:r,height:a,scores:x,categories:M,woodlandMask:c,averageScore:w.average,sampleCount:w.count,countsByCategory:m,bbox:o,requestId:n};N.postMessage(U,[x.buffer,M.buffer,c.buffer])}})();
//# sourceMappingURL=suitabilityWorker-BQsNZnxp.js.map
