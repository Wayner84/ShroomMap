var at=Object.defineProperty;var ut=(d,f,g)=>f in d?at(d,f,{enumerable:!0,configurable:!0,writable:!0,value:g}):d[f]=g;var T=(d,f,g)=>ut(d,typeof f!="symbol"?f+"":f,g);(function(){"use strict";var d=(t=>(t[t.Neutral=0]="Neutral",t[t.Dry=1]="Dry",t[t.Favourable=2]="Favourable",t))(d||{}),f=(t=>(t[t.Poor=0]="Poor",t[t.Caution=1]="Caution",t[t.Ideal=2]="Ideal",t))(f||{});const g=new Set([20,30,100]),X=new Set([90,95]),q=new Set([40,50,60,70,80]),_=10;function Y(t,e,r){const n=new Uint8Array(e*r);for(let o=0;o<t.length;o+=1){const s=t[o];g.has(s)?n[o]=2:q.has(s)?n[o]=0:(s===_||X.has(s),n[o]=1)}for(let o=0;o<r;o+=1)for(let s=0;s<e;s+=1){const h=o*e+s;if(t[h]!==_)continue;let i=!1;for(let c=Math.max(0,o-1);c<=Math.min(r-1,o+1)&&!i;c+=1)for(let a=Math.max(0,s-1);a<=Math.min(e-1,s+1);a+=1){if(a===s&&c===o)continue;const l=c*e+a;if(n[l]===2){i=!0;break}}i&&(n[h]=2)}return n}function z(t){if(!Number.isFinite(t))return 0;const e=t/1e3;return e<=.8?60:e<1.05?80+(e-.8)/.25*20:e<=1.35?100:e<=1.6?100-(e-1.35)/.25*30:e<=1.8?70-(e-1.6)/.2*40:20}function J(t){if(!Number.isFinite(t))return 0;const e=t/10;return e<=.5?5:e<3?Math.min(100,(e-.5)/2.5*80+20):e<=6?100:e<=10?100-(e-6)/4*50:e<=15?Math.max(20,50-(e-10)/5*50):10}function K(t){if(!Number.isFinite(t))return 0;const n=-.5*((t-6)/.6)**2,o=Math.exp(n)*100;return Math.max(0,Math.min(100,o))}function Q(t,e,r){if(![t,e,r].every(w=>Number.isFinite(w)&&w>=0))return 0;const n=t/10,o=e/10,s=r/10,h=n+o+s;if(h<=0)return 0;const i=n/h*100,c=o/h*100,a=s/h*100;let l=100;const b=Math.max(0,Math.abs(i-45)-10),M=Math.max(0,Math.abs(c-25)-6),x=Math.max(0,Math.abs(a-30)-10);return l-=b*2.2,l-=M*2.8,l-=x*1.5,i>70&&(l-=(i-70)*2.8),c>45&&(l-=(c-45)*3),Math.max(0,Math.min(100,l))}var C=(t=>(t[t.Poor=0]="Poor",t[t.Caution=1]="Caution",t[t.Ideal=2]="Ideal",t))(C||{});const P={ph:.32,organic:.22,texture:.28,moisture:.18};function W(t){let e=0,r=0;for(const n of t)Number.isFinite(n.score)&&(r+=n.score*n.weight,e+=n.weight);return e===0?0:r/e}function Z(t){const e=K(t.ph),r=J(t.orcdrc),n=Q(t.sand,t.clay,t.silt),o=z(t.bdod),s=W([{score:e,weight:P.ph},{score:r,weight:P.organic},{score:n,weight:P.texture},{score:o,weight:P.moisture}]);return{ph:e,organic:r,texture:n,moisture:o,overall:Math.max(0,Math.min(100,s))}}function $(t,e){if(!Number.isFinite(t)||e===f.Poor)return 0;const r=e===f.Caution?t-10:t;return r>=70?e===f.Caution?1:2:r>=45?1:0}class k{constructor(){T(this,"total",0);T(this,"n",0)}add(e){Number.isFinite(e)&&(this.total+=e,this.n+=1)}get count(){return this.n}get average(){return this.n===0?0:this.total/this.n}}const p=.2,tt=4.2,D=10,j=4,A=.8,F=3,et=12,nt=19;function m(t,e,r){return Math.min(r,Math.max(e,t))}function U(t,e,r,n){return!Number.isFinite(t)||n<=e||r<=e||r>=n||t<=e||t>=n?0:t===r?1:t<r?(t-e)/(r-e):(n-t)/(n-r)}function rt(t,e,r){let n=0,o=r;return t<A&&(n-=m((A-t)*8,0,12),o=Math.min(o,.3)),t>D&&(n-=m((t-D)*2,0,6)),e<F&&(n-=m((F-e)*1.8,0,10),o=Math.min(o,.35)),e>22&&(n-=m((e-22)*1.2,0,10),o=Math.min(o,.4)),t>j&&e>=8&&e<=16&&(n+=6,o=Math.max(o,.7)),{modifier:n,adjustedCombined:o}}function ot({baseScore:t,precipitation:e,temperature:r}){const n=Number.isFinite(t)?t:0;if(!Number.isFinite(e)||!Number.isFinite(r))return{adjustedScore:m(n,0,100),overlay:d.Neutral};const o=U(e,p,tt,D),s=U(r,F,et,nt),h=o*.65+s*.35,{modifier:i,adjustedCombined:c}=rt(e,r,h),a=m(c,0,1),l=(a-.5)*26,b=m(n+l+i,0,100);let M=d.Neutral;return e<=A||a<.32?M=d.Dry:e>=j&&a>=.65&&s>.45&&(M=d.Favourable),{adjustedScore:b,overlay:M}}const H=self;H.onmessage=t=>{const{soil:e,landCover:r,weather:n,bbox:o,requestId:s,config:h}=t.data,i=h!=null&&h.includeWeather&&n?n:null,c=Math.min(e.width,r.width,i?i.width:e.width),a=Math.min(e.height,r.height,i?i.height:e.height),l=c*a,b=r.codes.length===l?r.codes:r.codes.slice(0,l),M=Y(b,c,a),x=new Uint8Array(c*a),w=new Uint8Array(c*a),y=new Float32Array(c*a),R=new Uint8Array(c*a),v=new k,N={ideal:0,caution:0,poor:0},E=i?i.precipitation:null,I=i?i.temperature:null,L=i&&E&&I?Math.min(E.length,I.length,c*a):0,st=!!i&&!!E&&!!I&&L>0;for(let u=0;u<c*a;u+=1){const B=Z({ph:e.data.phh2o[u],orcdrc:e.data.orcdrc[u],bdod:e.data.bdod[u],sand:e.data.sand[u],clay:e.data.clay[u],silt:e.data.silt[u]}),ct=M[u]??f.Poor;let S=B.overall,G=d.Neutral;if(st&&u<L){const V=ot({baseScore:B.overall,precipitation:E[u],temperature:I[u]});S=V.adjustedScore,G=V.overlay}const O=$(S,ct);y[u]=S,R[u]=O,x[u]=b[u]===_?1:0,w[u]=G,v.add(S),O===C.Ideal?N.ideal+=1:O===C.Caution?N.caution+=1:N.poor+=1}const it={width:c,height:a,scores:y,categories:R,woodlandMask:x,weatherMask:w,averageScore:v.average,sampleCount:v.count,countsByCategory:N,bbox:o,requestId:s};H.postMessage(it,[y.buffer,R.buffer,x.buffer,w.buffer])}})();
//# sourceMappingURL=suitabilityWorker-C2zkbNxP.js.map
